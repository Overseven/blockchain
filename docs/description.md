# Что творится то!

## Содержание
- [Введение](#введение)
- [Участники сети](#учатники-сети)
  - [Клиент](#клиент)
  - [Координатор](#координатор)
  - [Нода](#нода)
  - [Валидатор](#валидатор)
- [Экономика](#экономика)
  - [Генерация новых монет](#генерация-новых-монет)
  - [Транзакции](#транзакции)
  - [Майнинг](#майнинг)
- [Голосование](#голосование)
- [Инструкции](#инструкции)
  - [Запуск клиента](#запуск-клиента)
  - [Запуск валидатора](#запуск-валидатора)
  - [Запуск ноды](#запуск-ноды)

## Введение
EverlastTry - экспериментальный блокчейн, для исследования возможностей распределенных технологий.

Основные характеристики:
- Алгоритм PoW([Proof-Of-Work](https://forklog.com/chto-takoe-proof-of-work-i-proof-of-stake/))
- Виды транзакций:
  - трансфер средств от одного кошелька к другому
  - аирдроп - генерация монет от лица модератора на указаный кошелек
  - заявка на [голосование](#голосование)
  - голос для [голосования](#голосование)

## Участники сети
### Клиент
Клиент - легковесная программа, позволяющая совершать транзакции со своего кошелька, отображать свой баланс, и некоторую статистику сети в целом.


Клиент при запуске получает от [координатора](#координатор) актуальный список адресов действующих нод.
При отправке транзакции, запрос на её обработку передаётся всем известным нодам.

Клиент в запросе указывает размер комиссии, которую он готов заплатить за обработку транзакции.

Для того, чтобы понять, проведена ли успешно транзакция, клиент подписывается на оповещения от известных нод о любом виде транзакции, связанном с их адресом. 
Если все, или большая часть нод ответила одинаково, то транзакция считается проведенной.

### Координатор
Координатор - утилита, запущенная на сервере с публичным IP. Задача координатора - по запросу предоставлять IP адреса действующих нод.

Участники обращаются к координатору в случаях:
- Первый запуск, нет информации о нодах
- Недоступность известных нод

### Нода
Нода - связующий элемент в сети, выполняет роль распределителя новых блоков.

При запуске, нода регистрируется у [координатора](#координатор), получает адреса и подключается к остальным нодам.

Нода может изменить свои параметры в сети через [транзакцию специального типа](#обновление-параметров-ноды), в которой должно быть указано распределение комиссии с подписываемых транзакций между самой нодой и валидатором.

К ноде подключаются [валидаторы](#валидатор). Валидаторам передаётся список транзакций для обработки, в ответ, валидаторы формируют подписанные блоки.
Нода отправляет всем остальным известным нодам полученный блок.

### Валидатор
Валидатор (майнер) - подключается к нодам, получает от них транзакции, требующие обработки.

Валидатор хранит полную версию блокчейна для валидации транзакций.

Транзакций проверяются на наличие достаточных средств на счетах, и объединяются в группу (блок), и начинает подбор [Nonce](https://coincentral.com/what-is-a-nonce-proof-of-work/#:~:text=The%20nonce%20is%20a%20central,blockchains%20and%20cryptocurrencies%20like%20Bitcoin.&text=The%20nonce%20is%20a%20random,so%20win%20the%20block%20reward.).

При успешном поиске, майнер отправляет всем нодам свой блок, со своим встроенным публичным адресом, для получения комиссии за валидацию.

Валидатор отслеживает появление на нодах новых блоков, и корректирует процесс майнинга, если в текущем подписываемом блоке есть уже обработанные транзакции. 

## Экономика
### Генерация новых монет
На первом этапе разработки, эмиссия монет не ограничена, и управляется [майнингом](#майнинг) новых блоков, [аирдропами](#аирдроп), и наградами за участие в [голосовании](#голосование).

### Транзакции
#### Трансфер

Любой участник сети, имеющий кошелек может инциировать перемещение своих средств на чужой кошелек.
Для этого, необходимо сформировать запрос на обработку транзакции. 
В него входят:
- Адрес отправителя
- Адрес получателя
- Сумма отправляемых средств
- Комиссия
- Временная метка
- Адрес ноды
- [Подпись](https://ru.wikipedia.org/wiki/%D0%AD%D0%BB%D0%B5%D0%BA%D1%82%D1%80%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D1%8C)

Для каждой ноды необходимо предоставить свою версию запроса, отличающуюся пунктом `Адрес ноды`. Пояснение в главе [майнинг](#майнинг).

Чтобы была возможность получить первые токены на валидации, существует возможность отправлять трансферы с нулевой суммой и комиссией, тогда ноды и валидаторы будут получать токены только от [эмиссии](#генерация-новых-монет).

#### Обновление параметров ноды
Для изменения параметров ноды, ей необходимо провести пустую транзакцию, содержащую новые параметры:
- Коэффициент, отвечающий за то, какую часть от суммы всех комиссий при валидации заберет себе нода. Диапазон значений от `0.0` до `1.0`. Остальное получает валидатор.

#### Аирдроп
Аирдроп - подарочные токены для кошелька с указанным адресом.
Аирдроп может быть организован только модератором, владельцем кошелька с общеизвестным, вшитым в код публичным адресом.
На счету модератора не могут храниться монеты, все транзакции, связанные с этим адресом, помимо аирдропа, игнорируются.

### Майнинг
[Клиенты](#клиент) отправляют [ноде](#нода) заявку на транзакцию, после чего, нода проверяет валидность данных (наличие на счету отправителя указаной суммы, правильный адрес ноды, подпись). Если поля транзакции корректны, то нода передаёт её всем подключенным к ней [валидаторам](#валидатор).

За подпись блока, между нодой и [валидатором](#валидатор) распределяется сумма комиссий со всех транзакций в блоке.

Базовое распределение комиссии:
- Нода - 20% от комиссии
- Валидатор - 80% от комиссии

Распределение награды можно регулировать с помощью специальной [команды](#обновление-параметров-ноды).

Помимо комиссий от транзакций, при создании блока генерируются новые монеты. На начальной стадии разработки, за каждый блок генерируется одинаковая сумма ELT, равная `кол-во транзакций в блоке * 10`.
Коэффициент может регулироваться путём [голосования](#голосование).

Новые монеты распределяются в равной пропорции между нодой и валидатором.

Все токены, полученные за валидацию присваиваются нодой и валидатором в полном объёме, без каких-либо комиссий.

## Голосование
В сети поддерживаются голосования за изменения численных и качественных параметров всей сети.
Например, можно провести голосование за изменение размера эмиссии при валидации.

Регулируемые параметры:
- минимальная сумма для начала голосования
- ограничение по времени для набора минимальной суммы для голосования
- минимальный и максимальный порог для голосования
- продолжительность голосования
- способ учета голосов
- объём эмиссии монет при подписи блока

Заявку на голосование может отправить любой участник сети. При создании заявки, создаётся уникальный идентификатор, являющийся альтернативой публичному адресу.
Для того, чтобы голосование началось, необходимо заморозить (сделать транзакцию на идентификатор) минимально необходимое кол-во токенов. Остальные участники сети могут поддержать проведение голосования, отправляя свои токены на тот же адрес.

Если число замороженных токенов превышает пороговое значение, то через 10 блоков начинается голосование за изменения. Голосование длится 30 блоков. Если минимальная сумма не успевает набраться за 10 блоков, то голосование не будет начато.
Вне зависимости от результата, владельцам возвращаются токены с бонусом, немного превышающим оплаченную комиссию. Транзакции на адреса голосования, приходящие после окончания голосования отбрасываются.

## Инструкции
### Запуск клиента
На первом этапе, клиент - это консольная утилита, представляющая из себя отдельный .exe файл, со следующими входными параметрами:
- Обязательные:
  - `pubKey <addres>` - публичный адрес
  - `privKey <key>` - приватный ключ
- Опциональные:
  - `nodeToConnect <ip:port>` - адрес уже существующей ноды для подключения через неё в сеть.
  - `saveLocalChain <bool>` - битовый флаг (0/1, false/true), отвечающий за сохранение локальной копии блокчейна. При значении false информация о текущем балансе берётся исключительно от запросов к нодам. Значение по умолчанию - `false`.
  - `coordinator <ip:port>` - адрес [координатора](#координатор).
  - `cfgFile <path>` - путь до файла конфигурации, в котором заданы параметры выше.

Примечание. Один из параметров `nodeToConnect`, `coordinator` должен быть представлен. Возможно использование обоих флагов, тогда данные о нодах будут складываться из обоих источников.

Пример:

``client.exe -pubKey AkZbjJQOk9G8o6GhS3+5v0JdMKq5qUkmQ2uL9pPtDX2I -privKey 1NSqxZbRHjpajCAlUfoYeV6sG+JVfp/CwZ2JjtIj+QQ= -saveLocalChain true -coordinator 127.0.0.1:64``

Перечисленные параметры можно хранить в конфигурационном файле, и передавать программе путь до этого файла:

``client.exe -cfgFile myconfig.cfg``

Пример содержания конфигурационного файла:
```
pubKey:AkZbjJQOk9G8o6GhS3+5v0JdMKq5qUkmQ2uL9pPtDX2I
privkey:1NSqxZbRHjpajCAlUfoYeV6sG+JVfp/CwZ2JjtIj+QQ=
saveLocalChain:true
coordinator:127.0.0.1:64
```

### Запуск валидатора
Софт валидатора - консольная утилита со следующими входными параметрами:
Обязательные:
  - `pubKey <addres>` - публичный адрес
  - `privKey <key>` - приватный ключ
  - `nodeAddress <ip:port>` - адрес ноды для подключения
- Опциональные:
  - `saveLocalChain <bool>` - битовый флаг (0/1, false/true), отвечающий за сохранение локальной копии блокчейна. При значении `false` валидатор не проверяет получаемые от ноды транзакции на корректность. Значение по умолчанию - `false`.

После запуска, в консоль будет выводиться информация о событиях

### Запуск ноды

Параметры для запуска ноды:
- Обязательные:
  - `pubKey <addres>` - публичный адрес
  - `privKey <key>` - приватный ключ
- Опциональные:
  - `nodeToConnect <ip:port>` - адрес уже существующей ноды для подключения через неё в сеть.
  - `coordinator <ip:port>` - адрес [координатора](#координатор).
  - `cfgFile <path>` - путь до файла конфигурации, в котором заданы параметры выше.

Примечание. Один из параметров `nodeToConnect`, `coordinator` должен быть представлен. Возможно использование обоих флагов, тогда данные о нодах будут складываться из обоих источников.
